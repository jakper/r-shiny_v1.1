{
    "contents" : "shinyServer(function(input, output, session) {\n\t\t\n\t\t.theme<- theme(\n\t\t\t\t\taxis.line = element_line(colour = 'gray', size = .75), \n\t\t\t\t\tpanel.background = element_blank(),  \n\t\t\t\t\tplot.background = element_blank()\n\t\t\t\t )\t\n\t\n\t\n\t\t#file info\t\n\t\toutput$filetable <- renderTable({\n\t\t\tif(is.null(input$files) ) { return() }  else { \n\t\t\ttmp<-read.csv(input$files$datapath, header=T, stringsAsFactors =T)\n\t\t\ttmp<-tmp[,seq_along(1:ncol(tmp))<=10] # show max 10 columns and binf head tail calls\n\t\t\trbind(head(tmp,10),tail(tmp,10))\n\t\t\t\t# input$files \n\t\t\t\t\n\t\t\t\t} \n\t\t\t\n\t\t\t})\n\t\t\n\t\t#confirm load\n\t\toutput$caption<-renderText({\n\t\t\tif (!is.null(PCA.results())) {\n\t\t\t\t\t\"Principal Components Analysis\"\n\t\t\t\t} else {\n\t\t\t\t\tif(is.null(input$files)) { \"Load Data\" }  else { \"Data Loaded\"}\n\t\t\t\t}\n\t\t\t}) \n\t\t\n\t\t\n\t\t#number of PCs\n\t\toutput$PCs<-renderUI({\n\t\t\t\tif (is.null(input$files)) { return(NULL) }\n\t\t\t\tmaxPCs<-ncol(input$files)\n\t\t\t\tnumericInput(\"PCs\", \"Number of Principal Components\", \n\t\t\t\t2, min = 2, max = maxPCs)\n\t\t\t})\n\t\t\t\n\t\tPCA.results<-reactive({\n\t\t\t\tif (is.null(input$files)) { \n\t\t\t\t\t\treturn(NULL) \n\t\t\t\t\t} else {\n\t\t\t\t\t\t# list(data=read.csv(input$files$datapath, header=T, stringsAsFactors =T),\n\t\t\t\t\t\t# data2=rnorm(10))\n\t\t\t\t\t\t\n\t\t\t\t\t# }\n\t\t\t\t#adapted from another devium\n\t\t\t\tpca.inputs<-list()\n\t\t\t\tstart.data<<-read.csv(input$files$datapath, header=T, stringsAsFactors =T)\n\t\t\t\tpca.inputs$pca.data<-\"start.data\"\n\t\t\t\tpca.inputs$pca.algorithm<-input$method\n\t\t\t\tpca.inputs$pca.components<-input$PCs\n\t\t\t\tpca.inputs$pca.center<-input$center\n\t\t\t\tpca.inputs$pca.scaling<-input$scaling\n\t\t\t\tpca.inputs$pca.cv<-input$cv # currently not used\n\t\t\t\tdevium.pca.calculate(pca.inputs,return=\"list\",plot=F)\n\t\t\t\t}\n\t\t\t})\t\n\t\t\t\n\t\t\n\t\t\t\n\t\t#make screeplot\n\t\toutput$screeplot <- renderPlot({\n\t\t\t\t\tif (is.null(PCA.results())) { \n\t\t\t\t\t\treturn(NULL)\n\t\t\t\t\t} else {\n\t\t\t\t\t\tx<-PCA.results()\n\t\t\t\t\t\tx<-data.frame(x$pca.eigenvalues)\n\t\t\t\t\t\t\n\t\t\t\t\t\t# make.scree.plot(x)\t\n\t\t\t\t\t\tmake.scree.plot.bar(x)\n\t\t\t\t\t}\n\t\t\t\t})\t\n\t\t\t\t\n\t\t# scores diagnostic plot\n\t\toutput$scores <- renderPlot({\n\t\t\t\t\tif (is.null(PCA.results())) { \n\t\t\t\t\t\treturn(NULL)\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmp<-PCA.results()\n\t\t\t\t\t\tscores<-data.frame(tmp$pca.scores)\n\t\t\t\t\t\tif(nrow(tmp$pca.diagnostics)==nrow(scores))\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\tif(any(tmp$pca.diagnostics$DmodX==\"NaN\")){tmp$pca.diagnostics$DmodX<-1}\n\t\t\t\t\t\t\t\t\tscores<-data.frame(leverage=tmp$pca.diagnostics$leverage, dmodx=tmp$pca.diagnostics$DmodX,scores)\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tscores<-data.frame(leverage=1, dmodx=1,scores)\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\tp<-ggplot(scores,mapping = aes_string(x = names(scores)[3], y = names(scores)[4],color=names(scores)[1],size=names(scores)[2])) + \n\t\t\t\t\t\tscale_size_continuous(\"DmodX\", range = c(4, 10)) + \n\t\t\t\t\t\tgeom_point(alpha=0.75) +.theme\n\t\t\t\t\t\tprint(p)\n\t\t\t\t\t}\n\t\t\t\t})\t\n\t\t#loadings plot\n\t\toutput$loadings <- renderPlot({\n\t\t\t\t\tif (is.null(PCA.results())) { \n\t\t\t\t\t\treturn(NULL)\n\t\t\t\t\t} else {\n\t\t\t\t\t\ttmp<-PCA.results()\n\t\t\t\t\t\tloadings<-data.frame(tmp$pca.loadings,names=rownames(tmp$pca.loadings))\n\t\t\t\t\t\t\n\t\t\t\t\t\t#plot\n\t\t\t\t\t\tp<-ggplot(loadings,mapping = aes_string(x = names(loadings)[1], y = names(loadings)[2], label = \"names\")) + \n\t\t\t\t\t\tgeom_text(size=4,alpha=0.75) +.theme\n\t\t\t\t\t\tprint(p)\n\t\t\t\t\t}\n\t\t\t\t})\t\n\t\t\t\t\n})",
    "created" : 1435097826117.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "3752750827",
    "id" : "DE03D69C",
    "lastKnownWriteTime" : 1372268558,
    "path" : "C:/Users/Jakob/shiny/Tests/pca/gist5846650-228a99831cf3d48904718f58d070ea19f2d2d64e/server.R",
    "project_path" : null,
    "properties" : {
    },
    "relative_order" : 4,
    "source_on_save" : false,
    "type" : "r_source"
}